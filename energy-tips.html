<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather-Based Energy Saving Tips</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Energy Tips specific styles */
        .energy-container {
            max-width: 1200px;
            margin: 90px auto 0;
            padding: 0 1rem;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .energy-container {
                grid-template-columns: 1fr;
            }
        }

        .weather-card {
            background: linear-gradient(145deg, var(--card-background), rgba(255, 255, 255, 0.1));
            padding: 2rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-box {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .search-box input {
            flex: 1;
            padding: 0.8rem;
            border: none;
            border-radius: 8px;
            box-shadow: var(--shadow);
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
        }

        .search-box button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .search-box button:hover {
            background: var(--secondary-color);
        }

        .current-weather {
            background: linear-gradient(145deg, var(--card-background), rgba(255, 255, 255, 0.1));
            padding: 2rem;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .weather-icon {
            font-size: 4rem;
            margin-bottom: 0.5rem;
        }

        .temperature {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(45deg, #4a90e2, #63cdda);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 1rem 0;
        }

        .city-name {
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary-color);
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .weather-detail {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .weather-detail i {
            width: 20px;
            text-align: center;
        }

        .tips-card {
            background: linear-gradient(145deg, var(--card-background), rgba(255, 255, 255, 0.1));
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 2rem;
        }

        .tips-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tips-title {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
        }

        .tips-content {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .tip-category {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .tip-category:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .tip-category h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-size: 1.3rem;
        }

        .tip-list {
            list-style-type: none;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .tip-item i {
            color: var(--secondary-color);
            margin-top: 0.25rem;
        }

        .energy-meter {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 15px;
        }

        .meter-label {
            display: flex;
            justify-content: space-between;
            font-weight: bold;
        }

        .meter-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .meter-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease-in-out;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 1.2rem;
            color: var(--text-color);
        }

        .error {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 200px;
            gap: 1rem;
            color: var(--danger-color);
        }

        .error i {
            font-size: 3rem;
        }
    </style>
</head>
<body>
    <!-- Navbar to match other pages -->
    <nav class="navbar">
        <div class="logo"><i class="fas fa-tshirt"></i> AI Wardrobe</div>
        <div class="nav-links">
            <a href="index.html">Weather & Outfits</a>
            <a href="outfit-analyzer.html">Outfit Analyzer</a>
            <a href="bot.html">Style Assistant</a>
            <a href="energy-tips.html" class="active">Energy Tips</a>
        </div>
        <div class="theme-toggle" style="cursor: pointer;">
            <i class="fas fa-moon"></i>
        </div>
    </nav>

    <main>
        <div class="energy-container">
            <div class="weather-card">
                <div class="search-box">
                    <input type="text" id="cityInput" placeholder="Enter city name...">
                    <button id="searchBtn"><i class="fas fa-search"></i> Search</button>
                </div>
                <div class="current-weather">
                    <!-- Weather data will be inserted here -->
                </div>
            </div>

            <div class="tips-card">
                <div class="tips-header">
                    <div class="tips-title">
                        <i class="fas fa-lightbulb"></i>
                        <span>Energy Saving Recommendations</span>
                    </div>
                </div>
                <div class="tips-content">
                    <!-- Tips will be inserted here -->
                </div>
            </div>
        </div>
    </main>

    <script src="js/theme.js"></script>
    <script>
        // Weather API functionality
        const searchBtn = document.getElementById('searchBtn');
        const cityInput = document.getElementById('cityInput');

        // Load default city when page loads
        window.addEventListener('load', () => {
            const currentWeather = document.querySelector('.current-weather');
            currentWeather.innerHTML = '<div class="loading">Please enter a city to get energy saving tips</div>';
            
            document.querySelector('.tips-content').innerHTML = `
                <div class="tip-category">
                    <h3><i class="fas fa-info-circle"></i> Getting Started</h3>
                    <ul class="tip-list">
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Enter your city name in the search box to get weather-based energy saving tips.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>We'll analyze the current weather conditions and provide customized recommendations.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Tips are tailored to help you save energy based on temperature, humidity, and other weather factors.</span>
                        </li>
                    </ul>
                </div>
            `;
        });

        // Search button event listener
        searchBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) {
                getWeatherData(city);
            }
        });

        // Enter key event listener for search
        cityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const city = cityInput.value.trim();
                if (city) {
                    getWeatherData(city);
                }
            }
        });

        async function getWeatherData(city) {
            try {
                const currentWeather = document.querySelector('.current-weather');
                currentWeather.innerHTML = '<div class="loading">Loading weather data...</div>';

                // Fetch current weather from our backend
                // Update the fetch URL from a relative path to the full Render URL
                const weatherResponse = await fetch(
                    `https://seasonal-wardrobe.onrender.com/energy/weather?city=${encodeURIComponent(city)}`
                );
                                
                if (!weatherResponse.ok) {
                    throw new Error('City not found');
                }
                
                const weatherData = await weatherResponse.json();

                // Update UI
                updateWeatherUI(weatherData);
                updateEnergyTips(weatherData);
                
                // Save successful search
                localStorage.setItem('lastSearchedCity', city);

            } catch (error) {
                console.error('Weather API Error:', error);
                const currentWeather = document.querySelector('.current-weather');
                currentWeather.innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>${error.message || 'Failed to fetch weather data. Please try again.'}</p>
                    </div>`;
                
                // Clear tips section on error
                document.querySelector('.tips-content').innerHTML = `
                    <div class="error">
                        <p>Unable to provide energy tips without weather data.</p>
                    </div>`;
            }
        }

        function updateWeatherUI(data) {
            const currentWeather = document.querySelector('.current-weather');
            const weatherIcon = getWeatherIcon(data.weather[0].main);
            const iconColor = getWeatherIconColor(data.weather[0].main);
            
            currentWeather.innerHTML = `
                <div class="weather-icon">
                    <i class="${weatherIcon}" style="color: ${iconColor}"></i>
                </div>
                <div class="temperature">${Math.round(data.main.temp)}°C</div>
                <div class="city-name">${data.name}, ${data.sys.country}</div>
                <div class="weather-description">${data.weather[0].description}</div>
                <div class="weather-details">
                    <div class="weather-detail">
                        <i class="fas fa-tint"></i>
                        <span>Humidity: ${data.main.humidity}%</span>
                    </div>
                    <div class="weather-detail">
                        <i class="fas fa-wind"></i>
                        <span>Wind: ${Math.round(data.wind.speed * 3.6)} km/h</span>
                    </div>
                    <div class="weather-detail">
                        <i class="fas fa-temperature-high"></i>
                        <span>Feels like: ${Math.round(data.main.feels_like)}°C</span>
                    </div>
                    <div class="weather-detail">
                        <i class="fas fa-compress-alt"></i>
                        <span>Pressure: ${data.main.pressure} hPa</span>
                    </div>
                </div>
            `;
        }

        function updateEnergyTips(data) {
            const tipsContent = document.querySelector('.tips-content');
            const temperature = data.main.temp;
            const weatherType = data.weather[0].main;
            const windSpeed = data.wind.speed;
            const humidity = data.main.humidity;
            
            // Clear previous tips
            tipsContent.innerHTML = '';
            
            // Calculate energy saving potential
            const savingPotential = calculateEnergySavingPotential(temperature, weatherType, windSpeed, humidity);
            
            // Add energy meter
            tipsContent.innerHTML += `
                <div class="energy-meter">
                    <div class="meter-label">
                        <span>Energy Saving Potential</span>
                        <span>${savingPotential}%</span>
                    </div>
                    <div class="meter-bar">
                        <div class="meter-fill" style="width: ${savingPotential}%; background-color: ${getMeterColor(savingPotential)}"></div>
                    </div>
                </div>
            `;
            
            // Generate tips based on weather conditions
            if (temperature < 15) {
                // Cold weather tips
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-thermometer-quarter"></i> Cold Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Set your thermostat to 18-20°C during the day and lower it by 3-5°C at night or when away.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use draft stoppers under doors and seal windows to prevent heat loss.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Open curtains during sunny days to let natural heat in, close them at night to insulate.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Wear layers of clothing and use blankets instead of turning up the heat.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use a programmable thermostat to automatically adjust temperatures throughout the day.</span>
                            </li>
                        </ul>
                    </div>
                `;
            } else if (temperature > 25) {
                // Hot weather tips
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-thermometer-full"></i> Hot Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Set your air conditioner to 24-26°C for optimal energy efficiency.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use ceiling fans to circulate air and reduce the need for air conditioning.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Close blinds and curtains during the hottest parts of the day to block heat.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use a dehumidifier in humid conditions to make the air feel cooler.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Cook outdoors or use microwave to avoid heating up your home.</span>
                            </li>
                        </ul>
                    </div>
                `;
            } else {
                // Moderate weather tips
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-thermometer-half"></i> Moderate Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Open windows for natural ventilation instead of using heating or cooling.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use natural light during the day instead of artificial lighting.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Hang clothes to dry naturally instead of using a dryer.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Turn off heating and cooling systems when weather is comfortable.</span>
                            </li>
                        </ul>
                    </div>
                `;
            }
            
            // Add general energy saving tips
            tipsContent.innerHTML += `
                <div class="tip-category">
                    <h3><i class="fas fa-lightbulb"></i> General Energy Saving Tips</h3>
                    <ul class="tip-list">
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Replace incandescent bulbs with LED lights to save up to 75% on lighting energy.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Unplug electronics and appliances when not in use to eliminate phantom energy use.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Use smart power strips for electronics that are frequently used together.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Run dishwashers and washing machines only when full and use cold water when possible.</span>
                        </li>
                        <li class="tip-item">
                            <i class="fas fa-check-circle"></i>
                            <span>Regularly maintain HVAC systems and clean filters for optimal efficiency.</span>
                        </li>
                    </ul>
                </div>
            `;
            
            // Add weather-specific tips
            if (weatherType === 'Rain' || weatherType === 'Drizzle') {
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-cloud-rain"></i> Rainy Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Collect rainwater for garden use to reduce water consumption.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use a rain sensor for your irrigation system to prevent watering during rain.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Ensure your home is properly insulated to prevent dampness and reduce heating needs.</span>
                            </li>
                        </ul>
                    </div>
                `;
            } else if (weatherType === 'Clear' && temperature > 20) {
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-sun"></i> Sunny Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Consider using solar-powered chargers for small devices.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Dry clothes outside instead of using a dryer to save energy.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use solar-powered outdoor lighting for gardens and pathways.</span>
                            </li>
                        </ul>
                    </div>
                `;
            } else if (weatherType === 'Wind' || windSpeed > 5) {
                tipsContent.innerHTML += `
                    <div class="tip-category">
                        <h3><i class="fas fa-wind"></i> Windy Weather Tips</h3>
                        <ul class="tip-list">
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Check for and seal air leaks around windows and doors to prevent heat loss.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Use windbreaks like trees or fences to protect your home from cold winds.</span>
                            </li>
                            <li class="tip-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Consider small-scale wind energy solutions if you live in a consistently windy area.</span>
                            </li>
                        </ul>
                    </div>
                `;
            }
        }

        function calculateEnergySavingPotential(temperature, weatherType, windSpeed, humidity) {
            // This is a simplified calculation for demonstration purposes
            let potential = 50; // Base potential
            
            // Adjust based on temperature
            if (temperature < 0) {
                potential += 20; // High potential in very cold weather
            } else if (temperature < 10) {
                potential += 15;
            } else if (temperature > 30) {
                potential += 15; // High potential in very hot weather
            } else if (temperature > 25) {
                potential += 10;
            } else {
                potential -= 5; // Lower potential in moderate weather
            }
            
            // Adjust based on weather type
            if (weatherType === 'Clear' && temperature > 15) {
                potential += 5; // Good for solar
            } else if (weatherType === 'Rain' || weatherType === 'Snow') {
                potential += 10; // More indoor time = more energy use = more saving potential
            }
            
            // Adjust based on wind
            if (windSpeed > 5) {
                potential += 5; // Windy conditions can affect heating/cooling
            }
            
            // Adjust based on humidity
            if (humidity > 70) {
                potential += 5; // High humidity can affect comfort and energy use
            }
            
            // Ensure the potential is within 0-100 range
            return Math.min(Math.max(potential, 0), 100);
        }

        function getMeterColor(value) {
            // Return color based on the value
            if (value < 30) {
                return '#F44336'; // Red - low potential
            } else if (value < 60) {
                return '#FFC107'; // Yellow - medium potential
            } else {
                return '#4CAF50'; // Green - high potential
            }
        }

        function getWeatherIcon(weatherType) {
            const icons = {
                'Clear': 'fas fa-sun',
                'Clouds': 'fas fa-cloud',
                'Rain': 'fas fa-cloud-rain',
                'Snow': 'fas fa-snowflake',
                'Thunderstorm': 'fas fa-bolt',
                'Drizzle': 'fas fa-cloud-rain',
                'Mist': 'fas fa-smog'
            };
            return icons[weatherType] || 'fas fa-cloud';
        }

        function getWeatherIconColor(weatherType) {
            const colors = {
                'Clear': '#ffd700', // Gold for sun
                'Clouds': '#8c9eff', // Light blue for clouds
                'Rain': '#4fc3f7', // Blue for rain
                'Snow': '#e1f5fe', // Light cyan for snow
                'Thunderstorm': '#5c6bc0', // Indigo for storm
                'Drizzle': '#81d4fa', // Light blue for drizzle
                'Mist': '#b0bec5' // Grey for mist
            };
            return colors[weatherType] || '#8c9eff';
        }
    </script>
</body>
</html>